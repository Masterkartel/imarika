<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard | Imarika</title>
<link rel="icon" href="/favicon.svg">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#fff;--text:#0f172a;--muted:#475569;--line:#e5e7eb;--card:#fff;--brand:#f59e0b;--ok:#16a34a;--danger:#ef4444;--ring:rgba(245,158,11,.35)}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  a{text-decoration:none;color:inherit}
  .container{max-width:1120px;margin:0 auto;padding:0 1rem}
  header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:40}
  .brand{display:flex;align-items:center;gap:.55rem;height:64px}
  .logo{height:32px;width:32px;border-radius:10px}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:.85rem 1.1rem;border-radius:14px;font-weight:700;background:var(--brand);color:#111827;border:0;cursor:pointer;box-shadow:0 10px 30px rgba(245,158,11,.25)}
  .btn-outline{background:#fff;border:1px solid var(--line)}
  .grid{display:grid;gap:1rem} .grid2{grid-template-columns:1fr} @media(min-width:768px){.grid2{grid-template-columns:2fr 1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:1.15rem;box-shadow:0 10px 30px rgba(2,8,23,.06)}
  input,select,textarea{width:100%;padding:.85rem;border:1px solid var(--line);border-radius:14px;outline:none}
  input:focus,select:focus,textarea:focus{border-color:#cbd5e1;box-shadow:0 0 0 4px var(--ring)}
  .muted{color:var(--muted)} .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
  .modal{position:fixed;inset:0;background:rgba(2,8,23,.45);display:none;align-items:center;justify-content:center;z-index:80;padding:1rem}
  .modal.active{display:flex} .sheet{width:100%;max-width:520px;background:#fff;border:1px solid var(--line);border-radius:16px;padding:1rem}
</style>

<body>
  <header>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between">
      <a class="brand" href="/"><img src="/favicon.svg" class="logo" alt=""><strong>Imarika</strong></a>
      <div style="display:flex;gap:.6rem">
        <button class="btn btn-outline" id="openLogin">Login</button>
        <button class="btn" id="openSignup">Create Account</button>
      </div>
    </div>
  </header>

  <section>
    <div class="container">
      <h1 style="margin:1rem 0 .5rem">Dashboard</h1>
      <div class="muted" id="who"></div>

      <div id="dash" class="grid grid2" style="margin-top:1rem;display:none">
        <div class="grid">
          <div class="card">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div><strong>Wallet Balance</strong><div class="muted">Available to invest/withdraw</div></div>
              <div style="text-align:right">
                <div id="wallet" style="font-weight:800;font-size:1.6rem">KES 0</div>
                <div id="stamp" class="muted mono"></div>
              </div>
            </div>
            <div style="margin-top:1rem;display:flex;gap:.6rem;flex-wrap:wrap">
              <a class="btn" href="/deposit.html">Deposit</a>
              <button class="btn btn-outline" id="showWithdraw">Withdraw</button>
            </div>
          </div>

          <div class="card">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div><strong>Investments (Shares)</strong><div class="muted">Active amount in plans</div></div>
              <div style="font-weight:800" id="shares">KES 0</div>
            </div>
          </div>

          <div class="card" id="withdrawCard" style="display:none">
            <strong>Withdraw to M-Pesa</strong>
            <div style="display:grid;gap:.6rem;margin-top:.6rem">
              <input id="wPhone" inputmode="tel" placeholder="M-Pesa number (07/01… 10 digits)">
              <input id="wAmt" type="number" placeholder="Amount (KES)">
              <button class="btn" id="doWithdraw">Request Withdraw</button>
              <div class="muted" id="wHint"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <strong>Quick Calculator</strong>
          <div class="muted">Preview 24h payout & start</div>
          <div style="display:grid;gap:.6rem;margin-top:.6rem">
            <select id="plan"><option value="std">Standard (30%)</option><option value="gold">Gold (50%)</option><option value="plat">Platinum (70%)</option></select>
            <input id="amt" type="number" min="1000" placeholder="Enter amount">
            <button class="btn" id="calc">Calculate</button>
            <div class="muted" id="out"></div>
            <a class="btn btn-full" href="/deposit.html">Start & Deposit</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SIGNUP -->
  <div class="modal" id="signupModal"><div class="sheet">
    <h3>Create Account</h3>
    <form id="sForm" style="display:grid;gap:.6rem">
      <input id="sFull" placeholder="Full Name (First Middle Last)" required>
      <input id="sId" inputmode="numeric" placeholder="ID Number *" required>
      <input id="sPhone" inputmode="tel" placeholder="Phone * (07/01… 10 digits)" required>
      <input id="sPass" type="password" placeholder="Password *" required>
      <input id="sPass2" type="password" placeholder="Confirm Password *" required>
      <button class="btn" type="submit">Create Account</button>
      <button class="btn btn-outline" type="button" id="closeSignup">Cancel</button>
      <div class="muted" id="sHint"></div>
    </form>
  </div></div>

  <!-- LOGIN -->
  <div class="modal" id="loginModal"><div class="sheet">
    <h3>Login</h3>
    <form id="lForm" style="display:grid;gap:.6rem">
      <input id="lPhone" inputmode="tel" placeholder="Phone (07/01… 10 digits)" required>
      <input id="lPass" type="password" placeholder="Password" required>
      <button class="btn" type="submit">Login</button>
      <button class="btn btn-outline" type="button" id="closeLogin">Cancel</button>
      <div class="muted" id="lHint"></div>
    </form>
  </div></div>

  <script>
    // helpers
    const fmt = n => Number(n).toLocaleString('en-KE');
    const phoneOk = p => /^0(7|1)\d{8}$/.test(String(p||'').trim());
    const acctNum = () => 'IMK-' + Math.random().toString(36).slice(2,6).toUpperCase() + '-' + Math.floor(Math.random()*9000+1000);
    const saveUser = u => localStorage.setItem('imarika_user', JSON.stringify(u));
    const getUser  = () => { try { return JSON.parse(localStorage.getItem('imarika_user')||'null'); } catch { return null; } };

    // ui
    const dash = document.getElementById('dash'), who = document.getElementById('who');
    const wallet = document.getElementById('wallet'), shares = document.getElementById('shares'), stamp = document.getElementById('stamp');

    function show(u){
      who.innerHTML = `<span class="muted">Acct:</span> <span class="mono"><strong>${u.account}</strong></span> • ${u.full||''}`;
      wallet.textContent = 'KES ' + fmt(u.wallet||0);
      shares.textContent = 'KES ' + fmt(u.invested||0);
      stamp.textContent = 'Updated ' + new Date().toLocaleString();
      dash.style.display='grid';
    }

    // modals
    const sM = document.getElementById('signupModal'), lM = document.getElementById('loginModal');
    const open = m => m.classList.add('active'), close = m => m.classList.remove('active');
    document.getElementById('openSignup').onclick = ()=>open(sM);
    document.getElementById('openLogin').onclick  = ()=>open(lM);
    document.getElementById('closeSignup').onclick= ()=>close(sM);
    document.getElementById('closeLogin').onclick = ()=>close(lM);
    sM.addEventListener('click',(e)=>{ if(e.target===sM) close(sM); });
    lM.addEventListener('click',(e)=>{ if(e.target===lM) close(lM); });

    // signup (no OTP)
    const sForm = document.getElementById('sForm'), sHint=document.getElementById('sHint');
    sForm.onsubmit = (e)=>{
      e.preventDefault();
      const full=sFull.value.trim(), idn=sId.value.trim(), phone=sPhone.value.trim(), pass=sPass.value, pass2=sPass2.value;
      if(!full||!idn){ sHint.textContent='Name and ID are required.'; return; }
      if(!phoneOk(phone)){ sHint.textContent='Phone must start with 07/01 and be 10 digits.'; return; }
      if(pass.length<6){ sHint.textContent='Password must be at least 6 characters.'; return; }
      if(pass!==pass2){ sHint.textContent='Passwords do not match.'; return; }
      const user={ full,idn,phone,passHash:btoa(pass),account:acctNum(),wallet:0,invested:0,createdAt:Date.now() };
      saveUser(user); close(sM); show(user); window.scrollTo({top:0,behavior:'smooth'});
    };

    // login
    const lForm = document.getElementById('lForm'), lHint=document.getElementById('lHint');
    lForm.onsubmit = (e)=>{
      e.preventDefault();
      const phone=lPhone.value.trim(), pass=lPass.value, u=getUser();
      if(!u || u.phone!==phone || u.passHash!==btoa(pass)){ lHint.textContent='Invalid phone or password.'; return; }
      close(lM); show(u); window.scrollTo({top:0,behavior:'smooth'});
    };

    // withdraw UI
    document.getElementById('showWithdraw').onclick = ()=> {
      const c = document.getElementById('withdrawCard');
      c.style.display = c.style.display==='none' ? 'block' : 'none';
    };
    document.getElementById('doWithdraw').onclick = ()=>{
      const p = wPhone.value.trim(), a = Number(wAmt.value||0), h = wHint;
      if(!phoneOk(p)){ h.textContent='Enter a valid M-Pesa number.'; return; }
      if(a<=0){ h.textContent='Enter amount.'; return; }
      h.textContent='Request submitted. (We’ll wire backend later.)';
    };

    // mini calculator
    document.getElementById('calc').onclick = ()=>{
      const plan=planEl.value, amt=Number(document.getElementById('amt').value||0), out=document.getElementById('out'),
            pct={std:30,gold:50,plat:70}[plan];
      if(!amt || amt<1000){ out.textContent='Enter at least KES 1,000'; return; }
      const earn=Math.round(amt*pct/100); out.innerHTML=`Projected earnings in 24h: <strong style="color:var(--ok)">KES ${fmt(earn)}</strong> • Total: <strong>KES ${fmt(amt+earn)}</strong>`;
    };
    const planEl=document.getElementById('plan');

    // show if already logged in
    const existing=getUser(); if(existing) show(existing);
  </script>
</body>
</html>
