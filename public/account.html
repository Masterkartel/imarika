<!doctype html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Account | Imarika</title>
<link rel="icon" href="/favicon.svg">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#fff;--text:#0f172a;--muted:#475569;--line:#e5e7eb;--brand:#f59e0b;--ring:rgba(245,158,11,.35)}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  a{text-decoration:none;color:inherit}
  .container{max-width:920px;margin:0 auto;padding:0 1rem}
  header{position:sticky;top:0;background:rgba(255,255,255,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--line);z-index:40}
  .brand{display:flex;align-items:center;gap:.55rem;height:64px}
  .logo{height:32px;width:32px;border-radius:10px}
  .card{background:#fff;border:1px solid var(--line);border-radius:18px;padding:1.15rem;box-shadow:0 10px 30px rgba(2,8,23,.06)}
  .grid{display:grid;gap:1rem} @media(min-width:768px){.grid2{grid-template-columns:1fr 1fr}}
  input{width:100%;padding:.85rem;border:1px solid var(--line);border-radius:14px;outline:none}
  input:focus{border-color:#cbd5e1;box-shadow:0 0 0 4px var(--ring)}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:.8rem 1rem;border-radius:14px;font-weight:700;background:var(--brand);color:#111827;border:0;cursor:pointer;box-shadow:0 10px 30px rgba(245,158,11,.25)}
  .btn-outline{background:#fff;border:1px solid var(--line)}
  .muted{color:var(--muted)}
  .pillbar{display:flex;gap:.6rem;margin:.8rem 0}
  .pill{padding:.4rem .8rem;border:1px solid var(--line);border-radius:999px;cursor:pointer}
  .pill.active{background:#ffedd5;border-color:#f59e0b;font-weight:700}
  .input-wrap{position:relative}
  .eye{position:absolute;right:10px;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer;padding:6px;border-radius:8px}
  .eye:focus{outline:2px solid var(--ring)}
  .inline-note{font-size:.9rem;color:#64748b;margin-top:-.3rem}
  footer{border-top:1px solid var(--line);padding:2.2rem 0;color:#475569;margin-top:2rem}
</style>

<body>
  <header>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between">
      <a class="brand" href="/"><img src="/favicon.svg" class="logo" alt=""><strong>Imarika</strong></a>
      <a class="btn-outline" style="padding:.55rem .8rem;border-radius:12px" href="/">← Home</a>
    </div>
  </header>

  <section>
    <div class="container">
      <div class="pillbar">
        <span id="pillLogin" class="pill active">Login</span>
        <span id="pillCreate" class="pill">Create account</span>
      </div>

      <div class="grid grid2" style="margin-top:1rem">
        <!-- CREATE -->
        <form id="sForm" class="card" onsubmit="return false;" style="display:grid;gap:.6rem;display:none">
          <h3>Create Account</h3>
          <input id="sFull" placeholder="Full Name (First Middle Last)" required>
          <input id="sId" inputmode="numeric" placeholder="ID Number *" required>
          <input id="sPhone" inputmode="tel" placeholder="Phone * (07/01… 10 digits)" required>

          <div class="input-wrap">
            <input id="sPIN" type="password" inputmode="numeric" maxlength="4" placeholder="4-digit PIN *" required>
            <button class="eye" type="button" aria-label="Show/Hide PIN" id="sEye">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="#334155" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="#334155" stroke-width="2"/>
              </svg>
            </button>
          </div>
          <div class="input-wrap">
            <input id="sPIN2" type="password" inputmode="numeric" maxlength="4" placeholder="Confirm PIN *" required>
            <button class="eye" type="button" aria-label="Show/Hide PIN" id="sEye2">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="#334155" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="#334155" stroke-width="2"/>
              </svg>
            </button>
          </div>
          <div class="inline-note">PIN must be exactly 4 digits.</div>

          <button class="btn" id="sBtn">Create Account</button>
          <div class="muted" id="sHint"></div>
        </form>

        <!-- LOGIN -->
        <form id="lForm" class="card" onsubmit="return false;" style="display:grid;gap:.6rem">
          <h3>Login</h3>
          <input id="lPhone" inputmode="tel" placeholder="Phone (07/01… 10 digits)" required>
          <div class="input-wrap">
            <input id="lPIN" type="password" inputmode="numeric" maxlength="4" placeholder="4-digit PIN" required>
            <button class="eye" type="button" aria-label="Show/Hide PIN" id="lEye">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="#334155" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="#334155" stroke-width="2"/>
              </svg>
            </button>
          </div>
          <button class="btn" id="lBtn">Login</button>
          <div class="muted" id="lHint"></div>
        </form>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:1rem;flex-wrap:wrap">
      <div style="display:flex;align-items:center;gap:.6rem">
        <img src="/favicon.svg" class="logo" alt="">
        <span>© <span id="y"></span> Imarika — <a class="muted" href="https://imarika.net">imarika.net</a></span>
      </div>
      <div style="display:flex;align-items:center;gap:.6rem;flex-wrap:wrap">
        <span class="muted">Payments Accepted:&nbsp;</span>
        <img src="/mpesa.png" alt="M-Pesa" style="height:60px;width:auto;vertical-align:middle">
        <span class="muted">·</span>
        <svg width="22" height="22" viewBox="0 0 24 24" aria-hidden="true"><path fill="#334155" d="M3 10.5 12 5l9 5.5v7A1.5 1.5 0 0 1 19.5 19h-15A1.5 1.5 0 0 1 3 17.5z"/><path fill="#94a3b8" d="M12 7.2 5 11v6.5h14V11z"/></svg>
        <strong>Bank Transfer</strong>
      </div>
    </div>
  </footer>

  <script>
    // UI helpers
    const y=document.getElementById('y'); y.textContent=new Date().getFullYear();
    const onlyDigits=s=>String(s||'').replace(/\D+/g,'');
    const phoneOk=p=>/^0(7|1)\d{8}$/.test(String(p||'').trim());
    function bindEye(inputId,btnId){const i=document.getElementById(inputId),b=document.getElementById(btnId);i.addEventListener('input',()=>{i.value=onlyDigits(i.value).slice(0,4);});b.onclick=()=>{i.type=i.type==='password'?'text':'password';};}
    bindEye('sPIN','sEye'); bindEye('sPIN2','sEye2'); bindEye('lPIN','lEye');

    // pill toggle (Login default)
    const pillLogin=document.getElementById('pillLogin'), pillCreate=document.getElementById('pillCreate');
    const lForm=document.getElementById('lForm'), sForm=document.getElementById('sForm');
    function show(which){ if(which==='login'){pillLogin.classList.add('active');pillCreate.classList.remove('active');lForm.style.display='grid';sForm.style.display='none';} else {pillCreate.classList.add('active');pillLogin.classList.remove('active');sForm.style.display='grid';lForm.style.display='none';} }
    pillLogin.onclick=()=>show('login'); pillCreate.onclick=()=>show('create'); show('login');

    // Create
    const sHint=document.getElementById('sHint');
    document.getElementById('sBtn').onclick=async()=>{
      const full=sFull.value.trim(), idn=sId.value.trim(), phone=sPhone.value.trim(), pin=sPIN.value.trim(), pin2=sPIN2.value.trim();
      sHint.textContent='';
      if(!full||!idn) return sHint.textContent='Name and ID are required.';
      if(!phoneOk(phone)) return sHint.textContent='Phone must start with 07/01 and be 10 digits.';
      if(pin.length!==4||pin!==pin2) return sHint.textContent='PIN must be exactly 4 digits and match.';
      try{
        const r=await fetch('/api/register',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({full_name:full,id_number:idn,phone,pin})});
        const j=await r.json();
        if(!j.ok) return sHint.textContent=j.error||'Failed';
        localStorage.setItem('imarika_user', JSON.stringify(j.user)); // keep a copy client-side
        window.location.href='/dashboard';
      }catch(e){ sHint.textContent='Network error'; }
    };

    // Login
    const lHint=document.getElementById('lHint');
    document.getElementById('lBtn').onclick=async()=>{
      const phone=lPhone.value.trim(), pin=lPIN.value.trim();
      lHint.textContent='';
      if(!phoneOk(phone)) return lHint.textContent='Enter a valid phone.';
      if(pin.length!==4) return lHint.textContent='PIN must be 4 digits.';
      try{
        const r=await fetch('/api/login',{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({phone,pin})});
        const j=await r.json();
        if(!j.ok) return lHint.textContent=j.error||'Invalid';
        localStorage.setItem('imarika_user', JSON.stringify(j.user));
        window.location.href='/dashboard';
      }catch(e){ lHint.textContent='Network error'; }
    };
  </script>
</body>
</html>
